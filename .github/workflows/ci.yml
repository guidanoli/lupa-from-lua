name: Continuous Integration

on: [push]

jobs:
  build:
    strategy:
      matrix:
        luaVersion: ["5.1.5", "5.2.4", "5.3.6", "5.4.2"]
        pythonVersion: ["2.7-dev", "3.5-dev", "3.6-dev", "3.7-dev", "3.8-dev", "3.9-dev"]
    
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v2
      - name: Setup Lua
        env:
          luaVersion: ${{ matrix.luaVersion }}
        run: |
          curl -R -O http://www.lua.org/ftp/lua-${{ env.luaVersion }}.tar.gz
          tar zxf lua-${{ env.luaVersion }}.tar.gz
          cd lua-${{ env.luaVersion}}
          sed 's/\(^MYCFLAGS.*\)/\1 -fPIC/' -i src/Makefile
          sudo make linux install test
      - name: Setup Python
        uses: gabrielfalcao/pyenv-action@v5
        with:
          default: ${{ matrix.pythonVersion }}
          command: pip install -U pip
